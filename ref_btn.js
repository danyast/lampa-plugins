//v8
(function(){'use strict';const c={name:'TV Refresh Button Plugin',version:'1.0.2',author:'Plugin Developer',description:'TV app optimized refresh button'};function r(){console.log('[TV Refresh] Attempting TV-specific refresh...');try{console.log('[TV Refresh] Using window.location.reload()');window.location.reload();return true;}catch(e){console.log('[TV Refresh] window.location.reload failed:',e)}try{if(typeof Lampa!=='undefined'&&Lampa.Listener){console.log('[TV Refresh] Using Lampa API...');Lampa.Listener.follow('view',function(e){if(e.type==='complete')console.log('[TV Refresh] View refreshed via Lampa')});if(Lampa.Listener.emit)Lampa.Listener.emit('view',{type:'refresh'});return true}}catch(e){console.log('[TV Refresh] Lampa API failed:',e)}try{if(window.Android&&window.Android.reload){console.log('[TV Refresh] Using Android.reload()');window.Android.reload();return true}}catch(e){console.log('[TV Refresh] Android.reload failed:',e)}try{const i=document.querySelectorAll('iframe');if(i.length>0){console.log('[TV Refresh] Reloading iframes...');i.forEach(f=>{if(f.src)f.src=f.src});return true}}catch(e){console.log('[TV Refresh] Iframe reload failed:',e)}try{const h=window.location.hash;if(h){console.log('[TV Refresh] Refreshing via hash change...');window.location.hash='';setTimeout(()=>{window.location.hash=h},100);return true}}catch(e){console.log('[TV Refresh] Hash refresh failed:',e)}try{console.log('[TV Refresh] Forcing DOM refresh...');const b=document.body,o=b.innerHTML;b.innerHTML='';setTimeout(()=>{b.innerHTML=o;console.log('[TV Refresh] DOM refreshed')},100);return true}catch(e){console.log('[TV Refresh] DOM refresh failed:',e)}try{console.log('[TV Refresh] Using postMessage...');window.postMessage({type:'REFRESH_PAGE'},'*');return true}catch(e){console.log('[TV Refresh] PostMessage failed:',e)}try{console.log('[TV Refresh] Dispatching custom event...');const e=new CustomEvent('tvRefresh',{detail:{timestamp:Date.now()}});window.dispatchEvent(e);return true}catch(e){console.log('[TV Refresh] Custom event failed:',e)}try{console.log('[TV Refresh] Trying app restart...');const h=setTimeout(function(){},0);for(let i=0;i<h;i++){clearTimeout(i);clearInterval(i)}window.location.reload();return true}catch(e){console.error('[TV Refresh] All methods failed:',e);return false}}function b(){const d=document.createElement('button');d.type='button';d.className='head__action selector tv-refresh-button';d.setAttribute('tabindex','0');d.innerHTML='';d.addEventListener('mouseenter',()=>{d.style.opacity='0.8';d.style.transform='scale(1.1)';d.style.filter='brightness(1.2)'});d.addEventListener('mouseleave',()=>{d.style.opacity='1';d.style.transform='scale(1)';d.style.filter='brightness(1)'});d.addEventListener('click',()=>{console.log('[TV Refresh] Button clicked, starting refresh sequence...');d.style.transform='rotate(360deg) scale(1.2)';d.style.transition='all 0.8s ease';d.style.filter='brightness(1.5)';setTimeout(()=>{const s=r();if(s){d.style.background='rgba(0,255,0,0.3)';d.style.filter='brightness(1.3)';console.log('[TV Refresh] Refresh initiated successfully')}else{d.style.background='rgba(255,0,0,0.5)';d.style.filter='brightness(0.8)';console.error('[TV Refresh] All refresh methods failed');try{if(typeof alert!=='undefined')alert('Обновление не удалось. Попробуйте перезапустить приложение.')}catch(e){console.error('Cannot show alert:',e)}}setTimeout(()=>{d.style.background='';d.style.filter='brightness(1)';d.style.transform='scale(1)'},2e3)},800)});d.addEventListener('keydown',(e)=>{if(e.key==='Enter'||e.keyCode===13){console.log('[TV Refresh] Enter pressed, starting refresh sequence...');d.style.transform='rotate(360deg) scale(1.2)';d.style.transition='all 0.8s ease';d.style.filter='brightness(1.5)';setTimeout(()=>{const s=r();if(s){d.style.background='rgba(0,255,0,0.3)';d.style.filter='brightness(1.3)';console.log('[TV Refresh] Refresh initiated successfully')}else{d.style.background='rgba(255,0,0,0.5)';d.style.filter='brightness(0.8)';console.error('[TV Refresh] All refresh methods failed');try{if(typeof alert!=='undefined')alert('Обновление не удалось. Попробуйте перезапустить приложение.')}catch(e){console.error('Cannot show alert:',e)}}setTimeout(()=>{d.style.background='';d.style.filter='brightness(1)';d.style.transform='scale(1)'},2e3)},800)}});return d}function i(){try{const s=['.head__actions','.head__action','.view--header','.view--navigation'];let t=null,m='';for(const sel of s){const e=document.querySelector(sel);if(e){t=e;m=sel;break}}if(!t){console.log('[TV Refresh] No target found, using fallback');return f()}if(t.querySelector('.tv-refresh-button'))return true;const r=b();t.appendChild(r);console.log([${c.name}] TV button injected into ${m});return true}catch(e){console.error('[TV Refresh] Injection failed:',e);return f()}}function f(){try{const e=document.querySelector('.tv-refresh-button');if(e)return;const r=b();r.style.cssText='position:fixed;top:30px;right:30px;z-index:9999;background:rgba(0,0,0,0.9);border-radius:10px;padding:15px;box-shadow:0 4px 20px rgba(0,0,0,0.5)';document.body.appendChild(r);console.log('[TV Refresh] Fallback button injected');return true}catch(e){console.error('[TV Refresh] Fallback failed:',e);return false}}function p(){console.log([${c.name}] Initializing TV plugin...);if(!i())setTimeout(i,1e3);setTimeout(i,2e3);setTimeout(i,5e3)}if(typeof Lampa!=='undefined'&&Lampa.Listener){Lampa.Listener.follow('full',function(e){if(e.type==='complete')setTimeout(i,200)});Lampa.Listener.follow('view',function(e){if(e.type==='complete')setTimeout(i,200)});console.log('[TV Refresh] Lampa listeners attached')}else{console.log('[TV Refresh] Lampa not available, using fallback');if(document.readyState==='loading')document.addEventListener('DOMContentLoaded',p);else p()}setInterval(()=>{if(!document.querySelector('.tv-refresh-button'))i()},1e4);window.addEventListener('message',function(e){if(e.data&&e.data.type==='REFRESH_PAGE'){console.log('[TV Refresh] Received refresh request via postMessage');r()}});window.addEventListener('tvRefresh',function(e){console.log('[TV Refresh] Received custom refresh event');r()})})();
